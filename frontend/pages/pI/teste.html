<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>

  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/barcodes/JsBarcode.code128.min.js"></script>
</head>

<body>
  <div id="ingressos-container"></div>

</body>
<script>
  document.addEventListener('DOMContentLoaded', async () => {
    const clienteId = '46';  // Substitua pelo ID do cliente apropriado
    const ingressos = await fetchIngressos(clienteId);
    const ingressosContainer = document.getElementById('ingressos-container');

    if (ingressos.length === 0) {
      ingressosContainer.innerHTML = '<p>Nenhum ingresso encontrado.</p>';
    } else {

      ingressosContainer.innerHTML = ingressos.map((ingresso, index) =>
        `
        <div class="ingresso">
          <h3>Codigo: ${ingresso.codigo}</h3>
          <p>Data da compra: ${ingresso.data_pedido}</p>
          <p>Data de utilização: ${ingresso.data_utilizacao}</p>
          <p>Usuário: ${ingresso.usuario.nome_completo}</p>
          <img id="barcode-${index}">
        </div>
        `
      ).join('');
      ingressos.forEach((ingresso, index) => {
        JsBarcode(`#barcode-${index}`, ingresso.codigo);
      });


    }
  });

  async function fetchIngressos(clienteId) {
    try {
      const response = await fetch(`http://localhost:3000/user/ingresso/${clienteId}`);
      if (!response.ok) {
        throw new Error('Erro ao buscar os ingressos');
      }
      const ingressos = await response.json();
      return ingressos;
    } catch (error) {
      console.error('Erro:', error);
      return [];
    }
  }

</script>

</html>